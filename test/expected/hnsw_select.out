---------------------------------------------------------------------
-- Test HNSW index selects
---------------------------------------------------------------------
\ir utils/small_world_array.sql
CREATE TABLE small_world (
    id VARCHAR(3),
    b BOOLEAN,
    v REAL[3]
);
INSERT INTO small_world (id, b, v) VALUES
    ('000', TRUE,  '{0,0,0}'),
    ('001', TRUE,  '{0,0,1}'),
    ('010', FALSE, '{0,1,0}'),
    ('011', TRUE,  '{0,1,1}'),
    ('100', FALSE, '{1,0,0}'),
    ('101', FALSE, '{1,0,1}'),
    ('110', FALSE, '{1,1,0}'),
    ('111', TRUE,  '{1,1,1}');
-- Verify where condition works properly and still uses index
SELECT * FROM small_world WHERE b IS TRUE ORDER BY v <-> '{0,0,0}';
 id  | b |    v    
-----+---+---------
 000 | t | {0,0,0}
 001 | t | {0,0,1}
 011 | t | {0,1,1}
 111 | t | {1,1,1}
(4 rows)

EXPLAIN (COSTS FALSE) SELECT * FROM small_world WHERE b IS TRUE ORDER BY v <-> '{0,0,0}';
               QUERY PLAN                
-----------------------------------------
 Sort
   Sort Key: ((v <-> '{0,0,0}'::real[]))
   ->  Seq Scan on small_world
         Filter: (b IS TRUE)
(4 rows)

-- todo:: Verify joins work and still use index
-- todo:: Verify incremental sorts work
